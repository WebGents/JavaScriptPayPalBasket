function Basket(a){this.cartItems=[];for(var b in a)if("cartItems"==b){for(var c in a[b])if(isInt(c)){var d=new CartItem(a[b][c]);this.cartItems.push(d)}}else this[b]=a[b];Basket.prototype.addCartItem=function(a){for(var b=!0,c=0;c<this.cartItems.length;c++){var d=this.cartItems[c];if(d.id==a.id){if(!(d.options.length>0)){this.cartItems[c].quantity=+this.cartItems[c].quantity+ +a.quantity,b=!1;break}var e=[];d.options.forEach(function(a){e.push(a.id)},this);var f=[];if(a.options.forEach(function(a){f.push(a.id)},this),e.sort().compare(f.sort())){this.cartItems[c].quantity=+this.cartItems[c].quantity+ +a.quantity,b=!1;break}}}b&&this.cartItems.push(a)},Basket.prototype.updateQuantity=function(a,b,c){for(var d=0;d<this.cartItems.length;d++){var e=this.cartItems[d];if(e.id==a){if(!(e.options.length>0)){this.cartItems[d].quantity=c;break}var f=[];if(e.options.forEach(function(a){f.push(a.id)},this),f.sort().compare(b.sort())){this.cartItems[d].quantity=c;break}}}},Basket.prototype.removeCartItem=function(a,b){for(var c=0;c<this.cartItems.length;c++){var d=this.cartItems[c];if(d.id==a){if(!(d.options.length>0)){this.cartItems.splice(c,1);break}var e=[];if(d.options.forEach(function(a){e.push(a.id)},this),e.sort().compare(b.sort())){this.cartItems.splice(c,1);break}}}},Basket.prototype.getTotalPrice=function(){if(this.hasItems()){for(var a=0,b=0;b<this.cartItems.length;b++){var c=this.cartItems[b];a+=+c.quantity*+c.getPrice().amount}return a}return 0},Basket.prototype.hasItems=function(){return this.cartItems.length>0}}function CartItem(a){this.id="",this.label="",this.quantity=0,this.prices=[],this.options=[];for(var b in a)if("prices"==b){for(var c in a[b])if(isInt(c)){var d=new Price(a[b][c]);this.prices.push(d)}}else this[b]=a[b];CartItem.prototype.addPrice=function(a){this.prices.push(a)},CartItem.prototype.addOption=function(a){this.options.push(a)},CartItem.prototype.getPrice=function(){var a=[];this.options.forEach(function(b){a.push(b.id)},this);for(var c,b=jQuery.grep(this.prices,function(b){return b.options.sort().compare(a.sort())}),d=0;d<b.length;d++){var e=b[d];e.quantity<=this.quantity&&(c?c.quantity<e.quantity&&(c=e):c=e)}return c}}function Price(a){this.amount=0,this.quantity=1,this.options=[],Price.prototype.addOption=function(a){this.options.push(a)};for(var b in a)this[b]=a[b]}function SelectOption(a){this.id="",this.label=""}function addHiddenInput(a,b,c){return a.append(jQuery("<input>",{type:"hidden",name:b,value:c}))}function checkout(){var a=getBasket();if(a.hasItems()){var b=jQuery("<form>",{action:"https://www.paypal.com/cgi-bin/webscr",method:"post",target:"_blank"});b=addHiddenInput(b,"cmd","_cart"),b=addHiddenInput(b,"upload","1"),b=addHiddenInput(b,"business",paypalEmail),b=addHiddenInput(b,"currency_code",paypalCurrency),b=addHiddenInput(b,"lc",paypalLanguage),b=addHiddenInput(b,"landing_page","Billing");var c=1;a.cartItems.forEach(function(a){var d=a.label;if(a.options.length>0)for(var f=0;f<a.options.length;f++){var g=a.options[f];d+=" - "+g.label}b=addHiddenInput(b,"item_name_"+c,d),b=addHiddenInput(b,"amount_"+c,a.getPrice().amount),b=addHiddenInput(b,"quantity_"+c,a.quantity),c+=1},this),b.hide(),jQuery(cartContainer).parent().append(b),b.submit()}}function redrawCart(){var a=jQuery(cartContainer);a.empty();var b=getBasket();if(b.hasItems())b.cartItems.sort(function(a,b){var c=a.label.toLowerCase(),d=b.label.toLowerCase();return c<d?-1:c>d?1:0}),b.cartItems.forEach(function(b){var c=b.getPrice(),d=b.label,e="";if(b.options.length>0)for(var f=!0,g=0;g<b.options.length;g++){var h=b.options[g];d+=" - "+h.label,f?(f=!1,e=h.id):e+=" "+h.id}var i='<div id="cart-item-container" data-id="'+b.id+'" data-options="'+e+'"><div class="cart-item-input-container"><input id="cart-amount" class="cart-item-amount" type="number" value="'+b.quantity+'"/></div><div class="cart-item-text"><div class="cart-item-label">'+d+'</div><br/><div class="cart-item-price">'+b.quantity+"x "+c.amount+'</div></div><input id="remove-cart-item" type="submit" class="cart-item-remove"/ value="x"></div>';a.append(i)},this),void 0!=checkoutButton&&(checkoutButton.disabled=!1);else{var c="<p>"+emptyBasketString+"</p>";a.append(c),void 0!=checkoutButton&&(checkoutButton.disabled=!0)}var d='<div id="basket-total">Total: '+b.getTotalPrice()+" "+paypalCurrency+"</div>";a.append(d)}function getBasket(){var a=JSON.parse(localStorage.getItem("junglecoder-basket"));return a?new Basket(a):new Basket}function setBasket(a){localStorage.setItem("junglecoder-basket",JSON.stringify(a)),redrawCart()}function parsePrice(a,b){var c=new Price;c.amount=b;for(var d=0;d<a.length;d++){var e=a[d];if("option"==e){d++;var f=a[d];c.addOption(f)}if("quantity"==e){d++;var g=a[d];c.quantity=g}}return c}function isInt(a){return a%1===0}var cartContainer=void 0,checkoutButton=void 0,paypalEmail=void 0,paypalCurrency="GBP",doCustomAction=void 0,paypalLanguage="GB",basketEmptyString="Basket is empty...";HTMLFormElement.prototype.addProduct=function(a,b){console.log(a),jQuery(this).submit(function(c){c.preventDefault();var d=new CartItem;d.id=this.id,d.label=a;for(var e=0;e<this.elements.length;e++){var f=this.elements[e],g=f.value,h=f.name;"quantity"==h&&(d.quantity=g)}for(var i=this.getElementsByTagName("select"),e=0;e<i.length;e++){var f=i[e],j=new SelectOption;j.id=f.value,j.label=f.options[f.selectedIndex].text,d.options.push(j)}if(Number.isInteger(b)){var k=new Price;k.amount=b,d.addPrice(k),console.log(b)}else{console.log(a),console.log(b),prices=b.prices;for(var e=0;e<prices.length;e++){var l=prices[e],k=new Price;k.amount=l.price.value,k.quantity=l.price.quantity,k.options=l.price.options,d.addPrice(k)}}console.log(d);var m=getBasket();m.addCartItem(d),setBasket(m)})},HTMLDivElement.prototype.basket=function(a){return void 0==a.email?void console.log("WARNING no email in settings, can't continue"):(void 0!=a.currency&&(paypalCurrency=a.currency),void 0!=a.locale&&(paypalLanguage=a.locale),void 0!=a.emptyBasketString&&(emptyBasketString=a.emptyBasketString),paypalEmail=a.email,cartContainer=this,doCustomAction=a.customAction,redrawCart(),jQuery(this).on("change","#cart-amount",function(){var a=jQuery(this).parents("#cart-item-container").attr("data-id"),b=jQuery(this).parents("#cart-item-container").attr("data-options").split(" "),c=getBasket(),d=jQuery(this).val();d<=0?c.removeCartItem(a,b):c.updateQuantity(a,b,d),setBasket(c)}),void jQuery(this).on("click","#remove-cart-item",function(){var a=jQuery(this).parent("#cart-item-container").attr("data-id"),b=jQuery(this).parent("#cart-item-container").attr("data-options").split(" "),c=getBasket();c.removeCartItem(a,b),setBasket(c)}))},HTMLElement.prototype.checkout=function(){checkoutButton=this,getBasket().hasItems()||(checkoutButton.disabled=!0),jQuery(this).click(function(a){a.preventDefault(),void 0!=doCustomAction?doCustomAction():checkout()})},Array.prototype.compare=function(a){if(this.length!=a.length)return!1;for(var b=0;b<a.length;b++)if(this[b].compare){if(!this[b].compare(a[b]))return!1}else if(this[b]!==a[b])return!1;return!0};